// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// User model for both tenants and landlords
model User {
  id        String     @id @default(cuid())
  clerkId   String     @unique
  email     String     @unique
  firstName String?
  lastName  String?
  role      Role       @default(TENANT)
  phone     String?
  avatar    String?
  bio       String?
  
  // For landlords
  properties      Property[]
  notifications   Notification[]
  inquiries       Inquiry[]      @relation("UserInquiries")
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum Role {
  TENANT
  LANDLORD
}

// Property model
model Property {
  id          String   @id @default(cuid())
  ownerId     String
  owner       User     @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  
  title       String
  description String?
  price       Decimal  @db.Decimal(10, 2)
  currency    String   @default("$")
  
  // Location
  address     String
  city        String
  state       String
  zipCode     String
  country     String
  latitude    Float?
  longitude   Float?
  
  // Details
  type        PropertyType
  listingType ListingType @default(RENT)
  bedrooms    Int
  bathrooms   Int
  sqft        Int
  
  // Media
  images      String[] // JSON array of image URLs
  thumbnail   String?
  
  // Features
  amenities   String[] // JSON array of amenity strings
  
  // Availability
  available   Boolean  @default(true)
  availableFrom DateTime?
  
  // Status
  status      PropertyStatus @default(ACTIVE)
  
  // Relations
  favorites   Favorite[]
  reviews     Review[]
  inquiries   Inquiry[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([ownerId])
  @@index([status])
}

enum ListingType {
  RENT
  SALE
}

enum PropertyType {
  APARTMENT
  HOUSE
  CONDO
  TOWNHOUSE
  STUDIO
  VILLA
  COMMERCIAL
}

enum PropertyStatus {
  ACTIVE
  INACTIVE
  RENTED
  PENDING
}

// Favorite/Wishlist model
model Favorite {
  id        String   @id @default(cuid())
  userId    String
  propertyId String
  property  Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@unique([userId, propertyId])
}

// Notification model
model Notification {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  title     String
  message   String
  type      NotificationType @default(INFO)
  isRead    Boolean  @default(false)
  
  // Optional link to related entity
  link      String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([userId])
  @@index([isRead])
}

enum NotificationType {
  INFO
  SUCCESS
  WARNING
  ERROR
  INQUIRY
}

// Review model
model Review {
  id        String   @id @default(cuid())
  propertyId String
  property  Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  
  authorId  String
  rating    Int      // 1-5
  comment   String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([propertyId])
  @@index([authorId])
}

// Property Inquiry model
model Inquiry {
  id        String   @id @default(cuid())
  propertyId String
  property  Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  
  // Link to the user who made the inquiry (if they are a registered user)
  userId    String?
  user      User?    @relation("UserInquiries", fields: [userId], references: [id], onDelete: SetNull)
  
  tenantName String
  tenantEmail String
  tenantPhone String?
  
  message   String?
  status    InquiryStatus @default(PENDING)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([propertyId])
  @@index([status])
}

enum InquiryStatus {
  PENDING
  CONTACTED
  ACCEPTED
  REJECTED
}
